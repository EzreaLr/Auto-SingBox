name: Sync Upstream

on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily at midnight UTC
  workflow_dispatch:  # Allows manual triggering

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Check for Upstream Changes
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git remote add upstream https://github.com/0xdabiaoge/singbox-lite.git
          git fetch upstream
          
          # Check if either README.md or singbox.sh has changes
          if git diff --name-only upstream/main -- README.md singbox.sh | grep -E "(README.md|singbox.sh)"; then
            echo "CHANGES_DETECTED=true" >> $GITHUB_ENV
          else
            echo "CHANGES_DETECTED=false" >> $GITHUB_ENV
          fi

      - name: Sync Files
        if: env.CHANGES_DETECTED == 'true'
        run: |
          git checkout upstream/main -- README.md singbox.sh
          git add README.md singbox.sh
          git commit -m "Sync README.md and singbox.sh from upstream (0xdabiaoge/singbox-lite)" || echo "No changes to commit"
          git push origin main
